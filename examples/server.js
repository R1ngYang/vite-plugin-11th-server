function server_default(e) { e.router("/aa", ((e, n) => { e.body, n.send({ a: 123123, b: { a: 123 } }) })), e.router("/bb", ((e, n) => { e.body, n.send(e.body) })) } function parseParams() { return { handle(e, n, a) { if (-1 != e.url.indexOf("?")) { const n = e.url.substring(e.url.indexOf("?") + 1).split("&"); e.params = Object.fromEntries(n.map((e => [e.substr(0, e.indexOf("=")), e.substr(e.indexOf("=") + 1)]))) } a() } } } function parseBody() { return { async handle(e, n, a) { await e.on("data", (n => e.body = JSON.parse(n))), a() } } } function send() { return { async handle(e, n, a) { n.send = e => n.end(JSON.stringify(e)), a() } } } var connect = require("connect"), app = connect(); app.use(parseParams()), app.use(parseBody()), app.use(send()), app.router = app.use, server_default(app), app.listen(3e3);